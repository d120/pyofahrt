{% extends "tasks/taskbase.html" %} {% load staticfiles %} {% block title %}Aufgabenverwaltung{% endblock %} {% block taskcontent %} {% load bootstrap3 %}
  <h3 style="margin-bottom:25px;">Ticket #{{ object.id }} - {{ object.name }}</h3>
  <ol class="breadcrumb">
    <li><a href="{% url "tasks:overview" %}">Aufgabenverwaltung</a></li>
    <li class="active">Ticket #{{ object.id }}</li>
  </ol>
  <h4 class="h4">Beschreibung</h4>
  {{ object.description }}
  <h4 class="h4">Informationen</h4>
    <table class="table" style="margin-top:10px;">
      <tr>
        <th>Status</th>
        <td>{{ object.status }}</td>
        <th>Eröffnet am</th>
        <td>{{ object.created_at }}</td>
      </tr>
      <tr>
        <th>Bearbeiter*innen</th>
        <td>{% if object.editors.all.count == 0 %}<i>- derzeit niemand -</i>{% else %}{% for editor in object.editors.all %}
          {% if editor.first_name and editor.last_name%}
          {{ editor.first_name}} {{ editor.last_name}}
          {% else %}
          {{ editor.username}}
          {% endif %}
          {% if not forloop.last %}, {% endif %}
          {% endfor %}{% endif %}</td>
        <th>Letzte Aktivität</th>
        <td>{{ object.updated_at }}</td>
      </tr>
      <tr>
        <th>Kategorie</th>
        <td>{{ object.category.name }}</td>
        <th>Priorität</th>
        <td>{{ object.priority }}</td>
      </tr>
    </table>

      <div class="btn-group btn-group-justified" role="group" aria-label="...">
        {% if user in object.editors.all and object.status == "zugewiesen" %}
        <a href="{% url "tasks:finish" object.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> erledigt</a>
        {% endif %}
        <a href="{% url "tasks:edit" object.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Ticket bearbeiten</a>
        <a href="{% url "tasks:assign" object.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span> Ticket zuweisen</a>
        {% if object.status == "abgebrochen" or object.status == "erledigt" %}
        <a href="{% url "tasks:reopen" object.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span> Ticket wiedereröffnen</a>
        {% elif not object.status == "erledigt" %}
        <a href="{% url "tasks:close" object.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span> Ticket schließen</a>
        {% endif %}
        <a href="{% url "tasks:comment" object.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> &nbsp;Kommentar verfassen</a>
        <a href="{% url "tasks:push" object.id %}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Push!</a>
      </div>


  <h4 class="h4">Kommentare</h4>
  {% if object.taskcomment_set.all.count == 0 %}<div class="alert alert-warning" role="alert"><b>Information:</b> Derzeit sind in diesem Ticket keine Kommentare vorhanden.</div>{% endif %}
  {% for comment in object.taskcomment_set.all %}
  <div class="taskcomment">
  <table>
    <tr>
      <th colspan="2">#{{ comment.id }}</th>
    </tr>
    <tr>
      <th class="taskcommentuser"><span {% if comment.user in object.editors.all %}title="Diese*r Benutzer*in ist Bearbeiter*in dieses Tickets" {% endif %} class="glyphicon glyphicon-user{% if comment.user in object.editors.all %} glyphicon-highlight{% endif %}" aria-hidden="true"></span>
        {% if comment.user.first_name and comment.user.last_name%}
        {{ comment.user.first_name}} {{ comment.user.last_name}}
        {% else %}
        {{ comment.user.username}}
        {% endif %}
        </th>
      <td class="taskcommenttext" rowspan="3">{{ comment.text | linebreaks }}</td>
    </tr>
    <tr>
      <td class="taskcommentuserinfos">
        {% if comment.user.groups.count > 0 %}
        <b>Orga:</b>
        <ul class="joblist">
          {% for job in comment.user.groups.all %}
          <li><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> {{ job.name }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% with workshops=comment.user.workshop_set.all %}
        {% if workshops.count > 0 %}
        <b>{{workshops.count}} Workshop{{ workshops.count|pluralize }}:</b>
        <ul class="joblist">
          {% for workshop in workshops %}
          <li><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> {{ workshop.name }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}
      </td>
    </tr>
    <tr>
      <td style="height:25px">{{ comment.timestamp }}</td>
    </tr>
  </table>
</div>
  {% endfor %}
  <h4 class="h4">Ticketverlauf</h4>
  <table class="table table-striped" style="margin-top: -15px;">
    <tr>
        <th style="width: 15%;">Zeitpunkt</th>
        <th style="width: 20%;">Benutzer</th>
        <th>Eintrag</th>
    </tr>
    {% if object.taskhistoryentry_set.all.count == 0%}
    <tr>
      <td colspan="3" style="text-align: center; font-style: italic;">Derzeit sind keine Historyeinträge verhanden.</td>
    </tr>
    {% endif %}
  {% for entry in object.taskhistoryentry_set.all|dictsort:"timestamp" %}
  <tr>
    <td>{{ entry.timestamp }}</td>
    <td>{% if entry.user.first_name and entry.user.last_name%}
    {{ entry.user.first_name}} {{ entry.user.last_name}}
    {% elif entry.username %}
    {{ entry.user.username}}
    {% else %}
    System
    {% endif %}</td>
    <td>
    {{ entry.text|safe }}
  </td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
